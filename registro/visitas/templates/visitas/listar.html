{% extends 'visitas/base.html' %}

{% block title %}
  Visitas Registradas
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto mt-12 p-8 bg-white rounded-xl shadow-md">
  <h1 class="text-2xl font-bold mb-6 text-green-600">Visitas Registradas</h1>
  
  <div class="mb-4 flex justify-between items-center">
    <a href="{% url 'visitas:inicio' %}" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"><i class="bi bi-house-door-fill"></i></a>
    <form method="get" class="flex items-center gap-2">
      <label for="fecha" class="font-semibold">Filtrar por día:</label>
      <input type="date" name="fecha" id="fecha" value="{{ fecha|default:'' }}"
             class="border border-gray-300 rounded px-2 py-1">
      <button type="submit" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">Filtrar</button>
    </form>
    <a href="{% url 'visitas:registrar_visita' %}" 
       class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
      Registrar Nueva
    </a>
  </div>

  <div class="overflow-x-auto">
    <table class="w-full table-auto border-collapse border border-gray-300 text-sm">
      <thead class="bg-gray-200">
        <tr>
          <th class="border border-gray-300 px-4 py-2">Nombre</th>
          <th class="border border-gray-300 px-4 py-2">Apellido</th>
          <th class="border border-gray-300 px-4 py-2">RUT</th>
          <th class="border border-gray-300 px-4 py-2">Motivo</th>
          <th class="border border-gray-300 px-4 py-2">Hora Entrada</th>
          <th class="border border-gray-300 px-4 py-2">Hora Salida</th>
          <th class="border border-gray-300 px-4 py-2">Acción</th>
        </tr>
      </thead>
      <tbody>
        {% for v in visitas %}
        <tr class="hover:bg-gray-50">
          <td class="border border-gray-300 px-4 py-2">{{ v.nombre }}</td>
          <td class="border border-gray-300 px-4 py-2">{{ v.apellido }}</td>
          <td class="border border-gray-300 px-4 py-2">{{ v.rut }}</td>
          <td class="border border-gray-300 px-4 py-2">{{ v.motivo }}</td>
          <td class="border border-gray-300 px-4 py-2">{{ v.hora_entrada|date:"H:i A" }}</td>
          <td class="border border-gray-300 px-4 py-2">
            {% if v.hora_salida %}
              {{ v.hora_salida|date:"H:i A" }}
            {% else %}
              <span class="text-red-500 font-semibold">Pendiente</span>
            {% endif %}
          </td>
          <td class="border border-gray-300 px-8 py-2 text-center">
            {% if not v.hora_salida %}
              <a href="{% url 'visitas:marcar_salida' v.pk %}" class="w-24 inline-block bg-red-500 text-white rounded hover:bg-red-600 transition text-center py-2">
                Marcar salida
              </a>
            {% endif %}
            <a href="{% url 'visitas:eliminar_visita' v.pk %}" 
               onclick="return confirm('¿Estás seguro de eliminar la visita de {{ v.nombre }} {{ v.apellido }}?');"
               class="w-10 inline-block bg-gray-500 text-white rounded hover:bg-gray-600 transition text-center py-2 mt-1">
              <i class="bi bi-trash3-fill"></i>
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-center py-4 text-gray-500">No hay visitas registradas</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
