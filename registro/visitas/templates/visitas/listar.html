{% extends 'visitas/base.html' %}

{% block title %}
  Lista de Visitas
{% endblock %}

{% block content %}
  <div class="max-w-5xl mx-auto mt-12 p-8 bg-white rounded-xl shadow-md border border-pink-200">
    <h1 class="text-2xl font-bold mb-6 text-pink-600 text-center">Visitas Registradas</h1>

    <div class="mb-6 flex justify-between items-center">
      <a href="{% url 'visitas:inicio' %}" 
         class="text-pink-500 font-medium hover:underline">
        <i class="bi bi-house-door-fill"></i> Inicio
      </a>

      <form method="get" class="flex items-center gap-2">
        <label for="fecha" class="font-semibold">Filtrar por día:</label>
        <input type="date" name="fecha" id="fecha" value="{{ fecha|default:'' }}"
              class="border border-gray-300 rounded px-2 py-1">
        <button type="submit" class="px-3 py-1 bg-pink-400 text-white rounded-lg shadow hover:bg-pink-500 transition">Filtrar</button>
      </form>

      <a href="{% url 'visitas:registrar_visita' %}" 
         class="px-3 py-1 bg-pink-400 text-white rounded-lg shadow hover:bg-pink-500 transition">
        <i class="bi bi-person-plus-fill"></i> Registrar Nueva
      </a>
    </div>

    <div class="overflow-x-auto rounded-lg border border-pink-200 shadow-sm">
      <table class="w-full table-auto text-sm border-collapse">
        <thead class="bg-pink-100 text-black-700">
          <tr>
            <th class="border border-pink-200 px-4 py-2 text-left">Nombre</th>
            <th class="border border-pink-200 px-4 py-2 text-left">Apellido</th>
            <th class="border border-pink-200 px-4 py-2 text-left">RUT</th>
            <th class="border border-pink-200 px-4 py-2 text-left">Motivo</th>
            <th class="border border-pink-200 px-4 py-2 text-left">Hora Entrada</th>
            <th class="border border-pink-200 px-4 py-2 text-left">Hora Salida</th>
            <th class="border border-pink-200 px-4 py-2 text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for v in visitas %}
          <tr class="hover:bg-pink-50 transition">
            <td class="border border-pink-100 px-4 py-2">{{ v.nombre }}</td>
            <td class="border border-pink-100 px-4 py-2">{{ v.apellido }}</td>
            <td class="border border-pink-100 px-4 py-2">{{ v.rut }}</td>
            <td class="border border-pink-100 px-4 py-2">{{ v.motivo }}</td>
            <td class="border border-pink-100 px-4 py-2">{{ v.hora_entrada|date:"d/m/Y H:i" }}</td>
            <td class="border border-pink-100 px-4 py-2">
              {% if v.hora_salida %}
                {{ v.hora_salida|date:"d/m/Y H:i" }}
              {% else %}
                <span class="text-pink-500 font-semibold">Pendiente</span>
              {% endif %}
            </td>
            <td class="border border-pink-100 px-4 py-2 text-center">
              <div class="flex flex-col items-center gap-2">
                {% if not v.hora_salida %}
                  <a href="{% url 'visitas:marcar_salida' v.pk %}" 
                     class="flex items-center justify-center gap-1 w-20 px-2 py-1 bg-pink-400 text-white rounded-lg shadow hover:bg-pink-500 transition">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>Salida</span>
                  </a>
                {% endif %}
                <a href="{% url 'visitas:eliminar_visita' v.pk %}" 
                   onclick="return confirm('¿Estás seguro de eliminar la visita de {{ v.nombre }} {{ v.apellido }}?');"
                   class="flex items-center justify-center gap-1 w-20 px-2 py-1 bg-gray-400 text-white rounded-lg shadow hover:bg-gray-500 transition">
                  <i class="bi bi-trash3-fill"></i>
                  <span>Eliminar</span>
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="text-center py-6 text-gray-500">
              <i class="bi bi-exclamation-circle"></i> No hay visitas registradas
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
